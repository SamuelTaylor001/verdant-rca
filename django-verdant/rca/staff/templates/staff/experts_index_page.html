{% extends "rca/base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block body_class %}type-experts-index{% endblock %}

{% block content %}
    <h1 class="h1 major">{{ page.title }}</h1>

    <section class="row pushstate-exclude">
        <section class="body-text-style">
            <div class="bc3 intro">
                {{ page.intro|richtext }}
            </div>
        </section>
    </section>

    <section class="filters two-filters row">
        <form id="filters" action="{% pageurl page %}" method="GET">
            <ul>
                <li class="filter">
                    <input type="text" name="q" placeholder="Search" autocomplete="off"
                           {% if query_string %}value="{{ query_string }}"{% endif %}
                    >
                </li>
                <li class="filter">
                    <label for="area_of_expertise">Area of expertise</label>
                    <select id="area_of_expertise" name="area_of_expertise">
                        <option value="">All Areas</option>
                        {% for pk, name in all_areas_of_expertise %}
                            <option {% if selected_area_of_expertise.pk == pk %}selected="selected"{% endif %}
                                    value="{{ pk }}">
                                {{ name }}
                            </option>
                        {% endfor %}
                    </select>
                </li>
                <input type="submit"/>
            </ul>
        </form>
    </section>

    <section class="module search-results pushstate-exclude">
        {% if query_string %}
            {% if search_results %}
                <h2>
                    Found {{ search_results.paginator.count }}
                    result{{ search_results.paginator.count|pluralize }} for
                    &quot;{{ query_string }}&quot;
                </h2>
            {% else %}
                <h2>Sorry, nothing was found for &quot;{{ query_string }}&quot;</h2>
            {% endif %}
        {% endif %}

        {% if search_results %}
            <h4 class="module-title">
                Results {{ search_results.start_index }}
                &ndash; {{ search_results.end_index }}
            </h4>

            <ul>
                {% for result in search_results %}
                    {% with result_specific=result.specific %}
                        <li class="row">
                            <a href="{% pageurl result_specific %}">
                                <div class="image">
                                    {% if result_specific.feed_image %}
                                        {% image result_specific.feed_image fill-180x160 %}
                                    {% else %}
                                        <img src="{% static 'rca/images/rca-placeholder-square.jpg' %}"
                                             width="180">
                                    {% endif %}
                                </div>
                                <div class="content">
                                    <h4 class="h6">{{ result_specific }}</h4>

                                    {% comment %}
                                    Note that we need to call the richtext filter here anyway,
                                    because we want to display ampersands correctly
                                    and make sure that all internal link representations
                                    were converted into valid html
                                    {% endcomment %}
                                    {{ result_specific.intro|richtext|striptags|truncatewords_html:50 }}
                                </div>
                            </a>
                        </li>
                    {% endwith %}
                {% endfor %}
            </ul>

            {% if search_results.has_previous or search_results.has_next %}
                <ul class="row pagination">
                    {% if search_results.has_previous %}
                        <li class="prev">
                            <a href="?{% if query_string %}q={{ query_string }}&amp;{% endif %}p={{ search_results.previous_page_number }}">
                                Previous
                            </a>
                        </li>
                    {% endif %}
                    {% if search_results.has_next %}
                        <li class="next">
                            <a href="?{% if query_string %}q={{ query_string }}&amp;{% endif %}p={{ search_results.next_page_number }}">
                                Next
                            </a>
                        </li>
                    {% endif %}
                </ul>
            {% endif %}

        {% endif %}
    </section>

    {% include "rca/includes/modules/twitter-feed.html" %}
{% endblock %}


{% block sidebar %}
    {% include "rca/includes/sidebar.html" with showToday="true" showRelatedLinks="true" collapseToday=page.collapse_upcoming_events %}
{% endblock %}
