{% extends "rca/base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}type-standard{% endblock %}

{% block content %}
    <h1 class="h1">{{ self.title }}</h1>
    {% include "rca/includes/modules/strapline.html" %}
    {% include "rca/includes/modules/carousel.html" %}
    <section class="row">

        <section class="body-text">
            <div class="bc3 intro">{{ self.intro|richtext }}</div>

            <form>
                <label for="courses">Select Course <abbr title="required">*</abbr></label>
                <br />
                <select
                id="courses"
                class="form-control"
                onchange="opportunityOptions.CourseTemplateID = this.options[this.selectedIndex].value"
                selected="731014"
                >
                </select>

                <label for="email">Email address <abbr title="required">*</abbr></label><br />
                <input id="email" class="form-control" type="email" />

                {% comment %} <label for="title">Title <abbr title="required">*</abbr></label><br />
                <input id="title" class="form-control" type="text" /> {% endcomment %}

                <label for="forename">First name <abbr title="required">*</abbr></label><br />
                <input id="forename" class="form-control" type="text" />

                <label for="surname">Last name <abbr title="required">*</abbr></label> <br />
                <input id="surname" class="form-control" type="text" />

                <label for="company">Company/Organisation</label> <br />
                <input id="company" class="form-control" type="text" />

                <label for="industry">Business Sector</label> <br />
                <input id="industry" class="form-control" type="text" />

                <label for="phone">Contact Telephone</label> <br />
                <input id="phone" class="form-control" type="text" />

                <label for="additional">Tell us more about your enquiry</label> <br />
                <textarea id="additional" class="form-control" cols="50" rows="4"></textarea>

                <button id="createEnquiry" class="btn btn-success btn-sm" type="button">Submit</button>
            </form>

            <script src="https://rca.accessplanit.com/accessplansandbox/NetLibrary/ClientScripts/webintegration.js"></script>

            <script type="text/javascript">
                var courseOptions = {
                    ListID: 'courses',
                    CourseIDs: [731014],
                    CompanyID: "ROYALC9RCH",
                    CategoryIDs: []
                }
                var opportunityOptions = {
                    OwnerID: "ROYALC9RCH",
                    Title: "Online enquiry",
                    Forename: "",
                    Surname: "",
                    Email: "",
                    Phone: "",
                    Mobile: "",
                    Address: "",
                    Town: "",
                    County: "",
                    Country: "",
                    Postcode: "",
                    CompanyName: "",
                    CompanyEmail: "",
                    CompanyPhone: "",
                    CompanyAddress: "",
                    CompanyTown: "",
                    CompanyCounty: "",
                    CompanyCountry: "",
                    CompanyPostcode: "",
                    CompanyGroupID: "",
                    CompanyGroupName: "",
                    IndustryName: "",
                    CourseTemplateID: "",
                    AdditionalInformation: "",
                    MarketingOptIn: ""
                }

                function emptyRequired(str){
                    return str === null || str.match(/^ *$/) !== null;
                }

                function createEnquiry() {
                    opportunityOptions.CourseTemplateID = $('#courses').val()
                    // Title field is used as *Opportunity* title
                    // opportunityOptions.Title = $('#title').val()
                    opportunityOptions.Email = $('#email').val()
                    opportunityOptions.Forename = $('#forename').val()
                    opportunityOptions.Surname = $('#surname').val()
                    opportunityOptions.CompanyName = $('#company').val()
                    opportunityOptions.IndustryName = $('#industry').val()
                    opportunityOptions.Phone = $('#phone').val()
                    opportunityOptions.AdditionalInformation = $('#additional').val()

                    // TODO: remove debug statement after staging
                    console.table(opportunityOptions)

                    if (emptyRequired(opportunityOptions.Forename) || emptyRequired(opportunityOptions.Surname) || emptyRequired(opportunityOptions.Email)) {
                        alert("Please enter all required values");
                        return;
                    }

                    EnquiryManager.createOpportunity(opportunityOptions, function (data) {
                        alert("Enquiry successfully sent.");
                        console.log("Enquiry successfully sent.");
                    }, function (data) {
                        alert(data.statusText);
                    });
                }

                document.addEventListener("DOMContentLoaded", function (e) {
                    $("#createEnquiry").on('click', createEnquiry);
                    setTimeout(function () { EnquiryManager.getCourses(courseOptions) }, 100);
                });

            </script>
        </section>

    </section>
{% endblock %}

{% block sidebar %}
    {% include "rca/includes/sidebar.html" with showToday="true" collapseToday=self.collapse_upcoming_events showRelatedLinks="true" showAdverts="true" %}
{% endblock %}
